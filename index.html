<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Pick Live Scoreboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 10px;
      background: #111; color: #fff;
      display: flex; flex-direction: column; align-items: center;
    }
    .tournament {
      margin-bottom: 5px;
      font-size: 18px;
      text-align: center;
    }
    .tournament input {
      background: transparent;
      border: none;
      border-bottom: 2px solid #ff0;
      color: #fff;
      font-size: 18px;
      text-align: center;
    }
    .camera-container {
      position: relative;
      max-width: 320px;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      overflow: hidden;
      border-radius: 10px;
    }
    video, canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
    }
    #liveIndicator {
      position: absolute;
      top: 8px; right: 8px;
      background: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      padding: 4px 6px;
      border-radius: 4px;
      display: none;
    }
    .scoreboard {
      display: flex; justify-content: space-between;
      width: 100%; max-width: 320px;
      margin-top: 6px;
      font-size: 16px;
    }
    .team {
      flex: 1;
      text-align: center;
    }
    .team input {
      background: transparent;
      border: none;
      border-bottom: 2px solid #ff0;
      color: #fff;
      font-size: 16px;
      text-align: center;
      width: 90%;
    }
    .points {
      display: flex; justify-content: center; align-items: center;
      margin-top: 2px;
    }
    .points span {
      font-size: 22px;
      margin: 0 6px;
    }
    button {
      background: #ff0;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: bold;
      margin: 3px;
    }
    .controls {
      margin-top: 10px;
      display: flex; flex-wrap: wrap; justify-content: center;
      max-width: 340px;
    }
    .controls button {
      flex: 1 1 45%;
      margin: 5px;
    }
  </style>
</head>
<body>
  <div class="tournament">
    <input id="tournamentName" placeholder="T√™n gi·∫£i ƒë·∫•u">
  </div>

  <div class="camera-container">
    <video id="camera" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>
    <div id="liveIndicator">LIVE</div>
  </div>

  <div class="scoreboard">
    <div class="team">
      <input id="teamAName" placeholder="ƒê·ªôi A">
      <div class="points">
        <button onclick="changeScore('A', -1)">-</button>
        <span id="scoreA">0</span>
        <button onclick="changeScore('A', 1)">+</button>
      </div>
      <div>
        <button onclick="adjustServe('A', 1)">+ Giao</button>
        <button id="decServeA" onclick="adjustServe('A', -1)" disabled>- Giao</button>
      </div>
    </div>
    <div class="team">
      <input id="teamBName" placeholder="ƒê·ªôi B">
      <div class="points">
        <button onclick="changeScore('B', -1)">-</button>
        <span id="scoreB">0</span>
        <button onclick="changeScore('B', 1)">+</button>
      </div>
      <div>
        <button onclick="adjustServe('B', 1)">+ Giao</button>
        <button id="decServeB" onclick="adjustServe('B', -1)" disabled>- Giao</button>
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="startRecording()">üé• Ghi h√¨nh</button>
    <button onclick="stopRecording()">‚èπ D·ª´ng</button>
    <button onclick="downloadVideo()">üíæ L∆∞u video</button>
    <button onclick="takePhoto()">üì∏ Ch·ª•p ·∫£nh</button>
  </div>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const liveIndicator = document.getElementById('liveIndicator');

let scoreA = 0, scoreB = 0;
let serveA = 0, serveB = 0;
let currentServer = null;
let timerInterval, startTime;
let mediaRecorder, recordedChunks = [];

// Camera init
navigator.mediaDevices.getUserMedia({
  video: { facingMode: { exact: "environment" }, width: { ideal: 1280 }, height: { ideal: 720 } },
  audio: true
}).then(stream => {
  video.srcObject = stream;
  drawLoop();
}).catch(err => console.error("Camera error:", err));

function changeScore(team, delta) {
  if(team==='A') scoreA=Math.max(0, scoreA+delta);
  if(team==='B') scoreB=Math.max(0, scoreB+delta);
}

function adjustServe(team, delta) {
  if(team==='A') {
    serveA=Math.max(0, Math.min(2, serveA+delta));
    if(delta<0 && serveA===0) { currentServer='B'; serveB=2; }
  }
  if(team==='B') {
    serveB=Math.max(0, Math.min(2, serveB+delta));
    if(delta<0 && serveB===0) { currentServer='A'; serveA=2; }
  }
  document.getElementById('decServeA').disabled = serveA===0;
  document.getElementById('decServeB').disabled = serveB===0;
}

function formatTime(sec) {
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `${m}:${s}`;
}

function drawLoop() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  // Timer
  if(startTime) {
    const elapsed = Math.floor((Date.now()-startTime)/1000);
    ctx.fillStyle='yellow';
    ctx.font='24px Arial';
    ctx.fillText(formatTime(elapsed), canvas.width-80, 30);
  }

  // Serve indicator
  ctx.fillStyle='red';
  if(serveA>0) {
    for(let i=0;i<serveA;i++) ctx.beginPath(),ctx.arc(20+i*15,30,6,0,2*Math.PI),ctx.fill();
  }
  if(serveB>0) {
    for(let i=0;i<serveB;i++) ctx.beginPath(),ctx.arc(canvas.width-20-i*15,30,6,0,2*Math.PI),ctx.fill();
  }

  requestAnimationFrame(drawLoop);
}

function startRecording() {
  startTime=Date.now();
  liveIndicator.style.display='block';
  recordedChunks=[];
  const stream=canvas.captureStream(30);
  const audioTracks=video.srcObject.getAudioTracks();
  if(audioTracks.length>0) stream.addTrack(audioTracks[0]);
  mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm;codecs=vp9'});
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0) recordedChunks.push(e.data);};
  mediaRecorder.start();
}

function stopRecording() {
  liveIndicator.style.display='none';
  if(mediaRecorder && mediaRecorder.state!=='inactive') mediaRecorder.stop();
}

function downloadVideo() {
  const blob=new Blob(recordedChunks,{type:'video/webm'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='recording.webm';
  a.click();
}

function takePhoto() {
  const img=canvas.toDataURL('image/png');
  const a=document.createElement('a');
  a.href=img;
  a.download='photo.png';
  a.click();
}
</script>
</body>
</html>
